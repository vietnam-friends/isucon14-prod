# ISUCONé©å¿œçš„ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰

## æ¦‚è¦

ã“ã®ã‚¬ã‚¤ãƒ‰ã¯ã€ç•°ãªã‚‹ISUCONå¹´åº¦ãƒ»ç’°å¢ƒã«å¯¾å¿œã™ã‚‹ãŸã‚ã®é©å¿œçš„ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ–¹æ³•ã‚’èª¬æ˜Žã—ã¾ã™ã€‚
ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åã€ãƒãƒ¼ãƒˆç•ªå·ã€ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆãŒç•°ãªã£ã¦ã‚‚è‡ªå‹•æ¤œå‡ºã—ã¦é©åˆ‡ã«è¨­å®šã—ã¾ã™ã€‚

## ðŸ” ãªãœé©å¿œçš„ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå¿…è¦ï¼Ÿ

### ISUCONã”ã¨ã«å¤‰ã‚ã‚‹è¦ç´ 
- **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å**: `isuride-go`, `isucon12-go`, `webapp`, `app` ãªã©
- **ãƒãƒ¼ãƒˆç•ªå·**: `8080`, `3000`, `8000`, `9000` ãªã©  
- **ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ**: `/home/isucon/webapp/go/`, `/opt/isucon/` ãªã©
- **ã‚µãƒ¼ãƒ“ã‚¹å**: `isuride-go.service`, `isucon-app.service` ãªã©

### å¾“æ¥ã®å•é¡Œç‚¹
- å›ºå®šå€¤ã§ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° â†’ ä»–ã®å¹´åº¦ã§å‹•ä½œã—ãªã„
- æ‰‹å‹•è¨­å®šãŒå¿…è¦ â†’ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã«æ™‚é–“ãŒã‹ã‹ã‚‹
- ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã‚„ã™ã„ â†’ è¨­å®šãƒŸã‚¹ã§ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒå‹•ä½œã—ãªã„

## ðŸš€ é©å¿œçš„ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®ä½¿ç”¨æ–¹æ³•

### 1. ç’°å¢ƒã®è‡ªå‹•æ¤œå‡º

```bash
# ã‚µãƒ¼ãƒãƒ¼ã«SSHæŽ¥ç¶š
ssh -i ~/Downloads/isucon14.pem ubuntu@13.230.155.251

# ç’°å¢ƒã®è‡ªå‹•æ¤œå‡º
bash scripts/detect_environment.sh
```

**æ¤œå‡ºã•ã‚Œã‚‹æƒ…å ±**:
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹åï¼ˆsystemdã‹ã‚‰è‡ªå‹•æ¤œå‡ºï¼‰
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ãƒˆç•ªå·ï¼ˆnetstatã‹ã‚‰è‡ªå‹•æ¤œå‡ºï¼‰
- Go main.goãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€ï¼ˆfindæ¤œç´¢ã§è‡ªå‹•æ¤œå‡ºï¼‰
- Nginxè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€
- MySQLè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€

### 2. é©å¿œçš„ãƒ­ã‚°è¨­å®š

```bash
# æ¤œå‡ºçµæžœã‚’ä½¿ç”¨ã—ã¦ãƒ­ã‚°è¨­å®š
bash scripts/setup_logging_adaptive.sh
```

**è‡ªå‹•ã§è¡Œã‚ã‚Œã‚‹ã“ã¨**:
- æ¤œå‡ºã•ã‚ŒãŸMySQLãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¹ãƒ­ãƒ¼ã‚¯ã‚¨ãƒªè¨­å®šã‚’è¿½åŠ 
- æ¤œå‡ºã•ã‚ŒãŸNginxè¨­å®šã«ã‚«ã‚¹ã‚¿ãƒ ãƒ­ã‚°ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆè¿½åŠ 
- æ¤œå‡ºã•ã‚ŒãŸGo main.goã«pprofè¨­å®šã‚’è¿½åŠ 
- æ¤œå‡ºã•ã‚ŒãŸã‚µãƒ¼ãƒ“ã‚¹åã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†èµ·å‹•

### 3. å‹•ä½œç¢ºèª

```bash
# ç’°å¢ƒè¨­å®šã®ç¢ºèª
source /home/isucon/isucon_env.sh
echo "ã‚¢ãƒ—ãƒªãƒãƒ¼ãƒˆ: $ISUCON_APP_PORT"
echo "ã‚µãƒ¼ãƒ“ã‚¹å: $ISUCON_APP_SERVICE"

# pprofã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆç¢ºèª
curl http://localhost:$ISUCON_APP_PORT/debug/pprof/
```

## ðŸ“‹ æ¤œå‡ºã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹æ¤œå‡º

```bash
# æ¤œç´¢ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆå„ªå…ˆåº¦é †ï¼‰
SERVICE_PATTERNS=(
    "isuride-go"      # ISUCON14å›ºæœ‰
    "isucon*-go"      # æ±Žç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ 
    "app-go"          # ã‚¢ãƒ—ãƒªç³»
    "webapp"          # Webã‚¢ãƒ—ãƒªç³»
    "isucon*"         # ISUCONæ±Žç”¨
    "*-app"           # ä»»æ„ã®ã‚¢ãƒ—ãƒª
    "go-*"            # Goç³»
)
```

### ãƒãƒ¼ãƒˆç•ªå·æ¤œå‡º

```bash
# 1. systemdã‚µãƒ¼ãƒ“ã‚¹è¨­å®šã‹ã‚‰æŠ½å‡º
# 2. listenã—ã¦ã„ã‚‹ãƒãƒ¼ãƒˆï¼ˆ8000-9999ï¼‰ã‹ã‚‰æ¤œå‡º
# 3. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ8080ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
```

### ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹æ¤œå‡º

```bash
# æ¤œç´¢ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆå„ªå…ˆåº¦é †ï¼‰
SEARCH_DIRS=(
    "/home/isucon/webapp/go"
    "/home/isucon/webapp/golang" 
    "/home/isucon/go"
    "/home/isucon/app"
    "/opt/isucon*"           # ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰å±•é–‹
    "/var/www/isucon*"
)
```

## ðŸ”§ AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨ã®é€£æº

### bottleneck-analyzer ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ

é©å¿œçš„ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å¾Œã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯è‡ªå‹•æ¤œå‡ºã•ã‚ŒãŸå€¤ã‚’ä½¿ç”¨ï¼š

```bash
# ç’°å¢ƒå¤‰æ•°ã®è‡ªå‹•ä½¿ç”¨
APP_PORT=$ISUCON_APP_PORT
SERVICE_NAME=$ISUCON_APP_SERVICE
GO_MAIN_PATH=$ISUCON_GO_MAIN_PATH

# pprofã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
curl http://localhost:$APP_PORT/debug/pprof/profile
```

### è¨­å®šã®æ°¸ç¶šåŒ–

æ¤œå‡ºçµæžœã¯ä»¥ä¸‹ã«ä¿å­˜ã•ã‚Œã¾ã™ï¼š
- `/tmp/isucon_env_detected.sh` - ä¸€æ™‚çš„ãªæ¤œå‡ºçµæžœ
- `/home/isucon/isucon_env.sh` - æ°¸ç¶šåŒ–ã•ã‚ŒãŸç’°å¢ƒè¨­å®š

## âš ï¸ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### è‡ªå‹•æ¤œå‡ºãŒå¤±æ•—ã™ã‚‹å ´åˆ

```bash
# æ‰‹å‹•ã§ã‚µãƒ¼ãƒ“ã‚¹ä¸€è¦§ã‚’ç¢ºèª
sudo systemctl list-units --type=service --state=active

# æ‰‹å‹•ã§ãƒãƒ¼ãƒˆç¢ºèª
sudo netstat -tulpn | grep LISTEN

# æ‰‹å‹•ã§Goãƒ•ã‚¡ã‚¤ãƒ«æ¤œç´¢
find /home/isucon -name "*.go" -type f
```

### éƒ¨åˆ†çš„å¤±æ•—ã¸ã®å¯¾å‡¦

```bash
# ç’°å¢ƒå¤‰æ•°ã‚’æ‰‹å‹•è¨­å®š
export ISUCON_APP_SERVICE="your-app-service"
export ISUCON_APP_PORT="8080"  
export ISUCON_GO_MAIN_PATH="/path/to/main.go"

# è¨­å®šã‚’ä¿å­˜
cat > /home/isucon/isucon_env.sh << EOF
export ISUCON_APP_SERVICE="$ISUCON_APP_SERVICE"
export ISUCON_APP_PORT="$ISUCON_APP_PORT"
export ISUCON_GO_MAIN_PATH="$ISUCON_GO_MAIN_PATH"
EOF
```

## ðŸ“ˆ å¯¾å¿œæ¸ˆã¿ç’°å¢ƒ

### ãƒ†ã‚¹ãƒˆæ¸ˆã¿ãƒ‘ã‚¿ãƒ¼ãƒ³

- **ISUCON14**: `isuride-go`, ãƒãƒ¼ãƒˆ8080, `/home/isucon/webapp/go/`
- **æ±Žç”¨Go**: `webapp`, ãƒãƒ¼ãƒˆ3000, `/home/isucon/go/`
- **å…¸åž‹çš„æ§‹æˆ**: `app-go`, ãƒãƒ¼ãƒˆ8000, `/opt/isucon/app/`

### æƒ³å®šã•ã‚Œã‚‹ä»–å¹´åº¦å¯¾å¿œ

- **ISUCON13**: `isucon13-go.service` 
- **ISUCON12**: `isucon12-webapp.service`
- **ISUCON11**: `isucondition.service`

## ðŸŽ¯ ä½¿ç”¨ä¾‹

### ISUCON14ï¼ˆå®Ÿéš›ã®è¨­å®šï¼‰

```bash
bash scripts/detect_environment.sh
# â†’ ã‚µãƒ¼ãƒ“ã‚¹: isuride-go
# â†’ ãƒãƒ¼ãƒˆ: 8080
# â†’ ãƒ¡ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«: /home/isucon/webapp/go/main.go

bash scripts/setup_logging_adaptive.sh
# â†’ å…¨ã¦è‡ªå‹•è¨­å®šå®Œäº†
```

### ä»®æƒ³çš„ãªISUCON13

```bash
bash scripts/detect_environment.sh
# â†’ ã‚µãƒ¼ãƒ“ã‚¹: isucon13-go
# â†’ ãƒãƒ¼ãƒˆ: 3000
# â†’ ãƒ¡ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«: /home/isucon/go/main.go

bash scripts/setup_logging_adaptive.sh
# â†’ é©å¿œçš„ã«è¨­å®šå®Œäº†
```

## ðŸ”„ ç¶™ç¶šçš„æ”¹å–„

### æ–°ã—ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã®è¿½åŠ 

æ–°ã—ã„ISUCONç’°å¢ƒã§æ¤œå‡ºã«å¤±æ•—ã—ãŸå ´åˆï¼š

1. `scripts/detect_environment.sh` ã®æ¤œç´¢ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¿½åŠ 
2. `scripts/setup_logging_adaptive.sh` ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–
3. ãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ `docs/adaptive-setup-guide.md` ã«è¿½è¨˜

### ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯å¾ªç’°

1. å®Ÿéš›ã®ç’°å¢ƒã§æ¤œå‡ºçµæžœã‚’ç¢ºèª
2. å¤±æ•—ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¨˜éŒ²
3. ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ”¹å–„
4. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°

ã“ã‚Œã«ã‚ˆã‚Šã€æ¯Žå¹´ã®ISUCONã§ç¢ºå®Ÿã«å‹•ä½œã™ã‚‹ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚·ã‚¹ãƒ†ãƒ ãŒå®Œæˆã—ã¾ã™ã€‚